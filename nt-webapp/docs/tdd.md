# Technical Design Document: NT Bird Monitor Webapp

## 1. Project Overview
* **Description**: A web-based dashboard to visualize and interact with bird call detection data processed by the `nt-bird-detect` pipeline.
* **Objective**: To provide an intuitive interface for viewing bird species counts, timestamps, and acoustic insights generated from sensor data.

---

## 2. Technology Stack
| Layer | Technology | Purpose |
| :--- | :--- | :--- |
| **Frontend** | React.js (Vite) | UI Components & Data Visualization |
| **Backend** | Python Flask | RESTful API to serve "Gold" layer data |
| **Database** | Parquet / SQLite | Processed analytics from the `nt-bird-detect` pipeline |
| **Proxy/Server** | **Nginx** | Serves static `dist` files and proxies API calls |
| **Containerization**| **Docker** | Ensures consistent environment across dev/prod |
| **Orchestration** | **Docker Compose**| Manages the Frontend, Backend, and Nginx services |

---

## 3. System Architecture
The application uses a **Containerized Client-Server Architecture** behind an Nginx reverse proxy.

* **Traffic Flow**: 
    1.  User visits port `80` (HTTP).
    2.  Nginx intercepts the request.
    3.  **Frontend**: If the request is for a UI page, Nginx serves static files from the `frontend/dist` folder.
    4.  **Backend**: If the request starts with `/api`, Nginx forwards (proxies) it to the Flask container on port `5000`.

nt-webapp/
├── docs/                      # Project documentation (TDD, architecture)
├── webapp/                    # Main application root
│   ├── docker-compose.yml     # Service orchestration
│   ├── backend/               # Flask API service
│   │   ├── api.py             # Main entry point for the API
│   │   ├── Dockerfile         # Python environment configuration
│   │   └── requirements.txt   # Python dependencies
│   ├── frontend/              # React/Vite UI service
│   │   ├── Dockerfile         # Node/Nginx multi-stage build
│   │   ├── nginx.conf         # Proxy and routing configuration
│   │   ├── package.json       # React dependencies
│   │   └── src/               # React components and logic
│   └── nginx/                 # (Optional) Global Nginx templates
└── .gitignore                 # Root-level Git exclusion rules

---

## 4. Data Integration (The "Gold" Layer)
The webapp does not process raw audio. It consumes the analytical output of the `nt-bird-detect` pipeline.

* **Source Path**: `../../nt-bird-detect/data/analytics/`
* **Format**: Cleaned Parquet files (Gold Layer).
* **Sync**: The Docker container mounts the analytics folder as a **volume**, allowing the Flask app to access updated data as the pipeline finishes its run.

---

## 5. API Specification
The Flask backend exposes the following endpoints:

| Endpoint | Method | Description | Data Source |
| :--- | :--- | :--- | :--- |
| `/api/summary` | GET | Total bird counts and species list | `bird_counts.parquet` |
| `/api/detections` | GET | List of specific detection events | `processed_detections.parquet` |
| `/api/health` | GET | Checks API and data access status | System Check |

---

## 6. Infrastructure & Docker Logic
### Service Definitions
* **`frontend` service**: Built using a multi-stage Dockerfile starting with Node 22 (Alpine) to support Vite 7 asset hashing.
    - 20260119_old: Built using an Nginx image. It hosts the production-ready assets generated by Vite in the `/dist` directory.
* **`backend` service**: Runs Gunicorn for production-grade concurrency.
    - 20260119_old: Runs Gunicorn/Flask. Includes `pandas` and `pyarrow` to read the Parquet files from the mounted volume.

---

## 7. Frontend Structure (Vite)
The React app is built with **Vite**, optimizing for speed and modern ESM support.

* **/src/components**: Reusable UI elements (Charts, SpeciesCards).
* **/src/pages**: Main views (Dashboard, History).
* **/dist**: The production-ready output directory created by `npm run build`.

---

## 8. Development Roadmap
- [x] Document system architecture and stack.
- [x] Configure `.gitignore` for monorepo safety.
- [x] Build React production assets via `npm run build`.
- [x] Create `Dockerfile` for Flask backend.
- [x] Create `nginx.conf` to bridge `dist` files and API.
- [x] Compose `docker-compose.yml` to link services.
- [ ] Implement Parquet reading logic in `backend/api.py`.